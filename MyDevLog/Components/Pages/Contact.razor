@page "/contact"
@using MyDevLog.Components.Shared
@using MyDevLog.Data
@using MyDevLog.Services
@inject IEmailService EmailService

<PageTitle>Contact Me</PageTitle>

<main class="main-container">
    <NavBar />

    <section class="about-container glass-effect fade-in-up" aria-labelledby="contact-heading">

        <header class="contact-header">
            <h1 id="contact-heading">Let's Connect!</h1>
            <p>
                I'm always open to discussing new projects, creative ideas, or opportunities to be part of your vision.
                Whether you have a question, a proposal, or just want to say hello, I'd love to hear from you.
            </p>
        </header>

        <section class="direct-contact">
            <h2 class="section-title">Or Reach Me Directly</h2>
            <div class="interests-cards">
                <a href="mailto:farhad10abdi@gmail.com" class="interest-card" tabindex="0">
                    <div class="interest-body">
                        <h4><i class="bi bi-envelope"></i> Email</h4>
                        <p class="interest-sub">farhad10abdi@gmail.com</p>
                    </div>
                </a>
                <a href="https://www.linkedin.com/in/farhad-abdi-626154236" target="_blank" rel="noopener noreferrer" class="interest-card" tabindex="0">
                    <div class="interest-body">
                        <h4><i class="bi bi-linkedin"></i> LinkedIn</h4>
                        <p class="interest-sub">Professional Profile</p>
                    </div>
                </a>
                <a href="https://github.com/FrhdAbdi" target="_blank" rel="noopener noreferrer" class="interest-card" tabindex="0">
                    <div class="interest-body">
                        <h4><i class="bi bi-github"></i> GitHub</h4>
                        <p class="interest-sub">Code & Projects</p>
                    </div>
                </a>
            </div>
        </section>

        <hr class="section-divider" />

        <section class="contact-form-section">
            <h2 class="section-title">Send Me a Message</h2>

            <EditForm Model="@contactForm" OnValidSubmit="@HandleValidSubmit" class="contact-form">
                <DataAnnotationsValidator />

                <div class="form-group">
                    <label for="name">Your Name</label>
                    <InputText id="name" class="form-control" @bind-Value="contactForm.Name" />
                    <ValidationMessage For="@(() => contactForm.Name)" />
                </div>
                <div class="form-group">
                    <label for="email">Your Email</label>
                    <InputText id="email" class="form-control" @bind-Value="contactForm.Email" />
                    <ValidationMessage For="@(() => contactForm.Email)" />
                </div>
                <div class="form-group">
                    <label for="subject">Subject</label>
                    <InputText id="subject" class="form-control" @bind-Value="contactForm.Subject" />
                    <ValidationMessage For="@(() => contactForm.Subject)" />
                </div>
                <div class="form-group">
                    <label for="message">Your Message</label>
                    <InputTextArea id="message" class="form-control" rows="6" @bind-Value="contactForm.Message" />
                    <ValidationMessage For="@(() => contactForm.Message)" />
                </div>

                <div class="form-group-submit">
                    <button type="submit" class="btn btn-primary" disabled="@isSubmitting">
                        @if (isSubmitting)
                        {
                            <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
                            <span class="ms-2">Sending...</span>
                        }
                        else
                        {
                            <span>Send Message</span>
                        }
                    </button>
                </div>
            </EditForm>

            @if (!string.IsNullOrEmpty(submissionStatusMessage))
            {
                <div class="submission-status @(isSuccess ? "success" : "error") mt-3">
                    @submissionStatusMessage
                </div>
            }
        </section>

    </section>
</main>

@code {
    private ContactForm contactForm = new ContactForm();

    private bool isSubmitting = false;
    private string submissionStatusMessage = string.Empty;
    private bool isSuccess = false;

    private async Task HandleValidSubmit()
    {
        isSubmitting = true;
        submissionStatusMessage = string.Empty;
        StateHasChanged();

        var result = await SendEmail(contactForm);

        if (result)
        {
            isSuccess = true;
            submissionStatusMessage = "Thank you! Your message has been sent successfully.";
            contactForm = new ContactForm();
        }
        else
        {
            isSuccess = false;
            submissionStatusMessage = "Sorry, there was an error sending your message. Please try again later or contact me directly via email.";
        }

        isSubmitting = false;
        StateHasChanged();
    }

    private async Task<bool> SendEmail(ContactForm model)
    {
        return await EmailService.SendContactEmailAsync(model);
    }
}